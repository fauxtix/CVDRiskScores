<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:CVDRiskScores.MVVM.ViewModels.SCORE2;assembly=CVDRiskScores"
    x:Class="CVDRiskScores.MVVM.Views.SCORE2.Score2ResultsPage"
    x:DataType="vm:Score2ResultsViewModel"
    Title="SCORE2 Resultado"
    BackgroundColor="#F4F5FA">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Voltar" Command="{Binding GoBackCommand}" Priority="0" Order="Primary" />
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="16">

            <!-- Header -->
            <Label Text="SCORE2"
                   FontSize="18"
                   FontAttributes="Bold"
                   HorizontalOptions="Center" />

            <!-- Result card -->
            <Border Padding="16" Background="{Binding Score2Model.RiskColor}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="#44000000" Offset="0,4" Radius="8" Opacity="0.25" />
                </Border.Shadow>

                <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto" RowSpacing="6">
                    <StackLayout Grid.Column="0" Spacing="2">
                        <Label Text="{Binding Score2Model.RiskCategory}"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="White"/>
                        <Label Text="{Binding Score2Model.ClinicalAdvice}"
                               FontSize="12"
                               TextColor="White"
                               Opacity="0.95"/>
                    </StackLayout>

                    <Label Grid.Column="1"
                           Text="{Binding Score2Model.RiskScore, StringFormat='{0:F1}%'}"
                           FontSize="34"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           HorizontalOptions="End"
                           TextColor="White"/>
                </Grid>
            </Border>

            <!-- Summary tiles -->
            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="8">
                <Border Padding="10" Background="White" Grid.Column="0" Grid.Row="0">
                    <Border.StrokeShape><RoundRectangle CornerRadius="8"/></Border.StrokeShape>
                    <VerticalStackLayout>
                        <Label Text="Idade (pontos)" FontSize="12" TextColor="#333" />
                        <Label Text="{Binding Score2Model.AgePoints, StringFormat='{0:F2}'}" FontSize="16" FontAttributes="Bold" />
                    </VerticalStackLayout>
                </Border>

                <Border Padding="10" Background="White" Grid.Column="1" Grid.Row="0">
                    <Border.StrokeShape><RoundRectangle CornerRadius="8"/></Border.StrokeShape>
                    <VerticalStackLayout>
                        <Label Text="Non‑HDL (pontos)" FontSize="12" TextColor="#333" />
                        <Label Text="{Binding Score2Model.NonHDLPoints, StringFormat='{0:F2}'}" FontSize="16" FontAttributes="Bold" />
                    </VerticalStackLayout>
                </Border>

                <Border Padding="10" Background="White" Grid.Column="0" Grid.Row="1">
                    <Border.StrokeShape><RoundRectangle CornerRadius="8"/></Border.StrokeShape>
                    <VerticalStackLayout>
                        <Label Text="TA Sistólica (pontos)" FontSize="12" TextColor="#333" />
                        <Label Text="{Binding Score2Model.SBPPoints, StringFormat='{0:F2}'}" FontSize="16" FontAttributes="Bold" />
                    </VerticalStackLayout>
                </Border>

                <Border Padding="10" Background="White" Grid.Column="1" Grid.Row="1">
                    <Border.StrokeShape><RoundRectangle CornerRadius="8"/></Border.StrokeShape>
                    <VerticalStackLayout>
                        <Label Text="Tabaco (pontos)" FontSize="12" TextColor="#333" />
                        <Label Text="{Binding Score2Model.SmokingPoints, StringFormat='{0:F2}'}" FontSize="16" FontAttributes="Bold" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Collapsible details (toolkit) -->
            <toolkit:Expander>
                <toolkit:Expander.Header>
                    <Label Text="Sobre o método, referências..." FontAttributes="Bold" />
                </toolkit:Expander.Header>
                <VerticalStackLayout BackgroundColor="White" Padding="12" Spacing="6">
                    <Label Text="Algoritmo SCORE2, guidelines ESC 2021, calibrado para a população portuguesa." FontSize="12" TextColor="#444" />
                    <Label Text="Referência: ESC Guidelines on Cardiovascular Disease Prevention 2021" FontSize="11" TextColor="DarkBlue" />
                </VerticalStackLayout>
            </toolkit:Expander>

            <!-- Single primary action -->
            <Button Text="Nova Simulação"
                    Command="{Binding NewSimulationCommand}"
                    HorizontalOptions="Fill"
                    BackgroundColor="#007ACC"
                    TextColor="White"
                    CornerRadius="8"
                    HeightRequest="48" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>